---
layout: post
title: JavaScript 笔记（一）：内存模型
author: wzhzzmzzy
date: 2019-5-31
categories: Tech
tags: 
    - 前端
    - JavaScript
description: JavaScript 内存模型简述，让我们了解一下 JS 声明变量时发生了什么吧。
---

### JS 原始数据类型的变量声明和赋值 ###

```js
let num = 23;
```

当我们创建了这么一个变量的时候，JS 会

1. 为变量创建一个唯一标识符，
2. 在内存里分配一个地址，
3. 将值 23 存储在分配的地址。

```js
let newNum = num;
```

此时，`num`和`newNum`指向的地址是相同的。

```js
num = num + 1;
```

这样会导致`num`和`newNum`指向不同的地址，因为 JS 中原始数据类型不可变，当`num + 1`解析为`24`的时候，JS 会在内存中分配一个新地址，将`24`作为其值存储，`num`指向新地址。

字符串也是一样，当修改了字符串之后，不会在原来的内存位置对原串进行修改，而是重新分配一个内存地址用于存放新串。

### 调用堆栈和堆 ###

“JS 中，原始数据类型放在调用栈中，而引用类型放在内存堆中。”

这句话基本是正确的，但是有一些小小的地方需要纠正：引用类型的变量本身也是放在栈中的。

### JS 引用类型的变量声明和赋值 ###

让我们从一个简单的例子开始。下面，我们声明一个名为`myArray`的变量，并用一个空数组初始化它。

```js
let myArray = [];
```

当你声明变量“`myArray`”并为其指定非原始数据类型（如“[]”）时，以下是在内存中发生的情况：

1. 为变量创建唯一标识符（“`myArray`”）
2. 在内存中分配一个地址（将在运行时分配）
3. 存储在堆上分配的内存地址的值（将在运行时分配）
4. 堆上的内存地址存储分配的值（空数组`[]`）

### `let` vs. `const` ###

一般来说，我们应该尽可能多地使用`const`，只有当我们知道某个变量将发生改变时才使用`let`。

事实上，`const`的意义是：不允许更改变量的内存地址，`let`则允许。所以可以使用`const`来声明引用类型，只要不更改其指向即可。

